@model ProductSales.Model.Product

@{
    ViewBag.Title = "Index";
}

<h2>Sales Product Page</h2>

<hr />
@using (Html.BeginForm("Index","Sales",FormMethod.Post))
{
    <div class="dropdown-header">
        <div class="form-horizontal">
            <div class="form-group">
                <div class="col-md-10">
                    @Html.DropDownList("drpProdId", new SelectList(ViewBag.List, "Id", "ProdName"), "Select Product..."
                                , new { @onchange = "this.form.submit();", @class = "form-control" })
                </div>
            </div>
            <div class="form-group">
                <div class="col-md-offset-2 col-md-10">
                    <input type="submit" value="Save" class="btn btn-primary" />
                </div>
            </div>
        </div>
        <br />
        <h4>@ViewBag.IsWarning</h4>
        <hr />
    </div>
    <div>
        @if (Model != null)
        {
            <h4>Customer Bill</h4>
            <hr />
            @Html.Hidden("Qty", Model.Qty)
            <dl class="dl-horizontal">
                <dt>
                    @Html.DisplayNameFor(model => model.ProdId)
                </dt>

                <dd>
                    @Html.DisplayFor(model => model.ProdId)
                </dd>

                <dt>
                    @Html.DisplayNameFor(model => model.ProdName)
                </dt>

                <dd>
                    @Html.DisplayNameFor(model => model.ProdName)
                </dd>

                <dt>
                    @Html.DisplayNameFor(model => model.Qty)
                </dt>

                <dd>
                    @Html.TextBox("txtQty", null, new { @type = "number" }) <br />
                    <p>Available Stock is-@Html.DisplayFor(model => model.Qty)</p>
                </dd>

                <dt>
                    @Html.DisplayNameFor(model => model.Price)
                </dt>

                <dd>
                    @Html.TextBox("txtPrice", Model.Price, new { @type = "number", @readonly = "readonly" }) <br />
                </dd>

                <dt>
                    @Html.DisplayName("Total Price")
                </dt>

                <dd>
                    @Html.TextBox("txtTotalPrice", 0, new { @type = "number", @readonly = "readonly" }) <br />
                </dd>

                <dd>
                    <div class="form-group">
                        <div class="col-md-offset-2 col-md-10">
                            <input type="submit" id="btnSubmit" value="Generate Bill" class="btn btn-primary" />
                        </div>
                    </div>
                </dd>

            </dl>
        }
    </div>
}
<script>
    $(function () {
        $('#btnSubmit').hide();
        var current = parseFloat($("#Qty").val());
        if (current == 0) {
            alert("Product is not in Stock, Please select diff product!!");
            $('#drpProdId').val(0);
            $('#btnSubmit').hide();
        }
        else {
            $("#txtQty").change(function () {
                var qty = this.value;
                if (qty <= current && qty > 0) {
                    var total = parseFloat($("#txtQty").val()) * parseFloat($("#txtPrice").val());
                    $("#txtTotalPrice").val(parseFloat(total))
                    $('#btnSubmit').show();
                }
                else if (qty >= current) {
                    alert("You cannot enter more than stock");
                    $('#txtQty').focus();
                    $('#btnSubmit').hide();
                }
                else {
                    alert("Qty cannot be less than 0");
                    $('#txtQty').focus();
                    $('#btnSubmit').hide();
                }
            });
        }
    })

    //$('#txtQty').change(function () {
    //    var qty = this.value;
    //    var price = parseInt($("#txtPrice").value;
    //    $.getJSON("/Sales/GetTotalPrice",
    //        {
    //            Qty: qty,
    //            Price: price
    //        },
    //        function (data) {
    //            $('#txtTotalPrice').val(data.total);
    //        });
    //});
</script>

